<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Astrological Transit Calculator </title>



<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>




/* ================= NOTE PATCH ================= */

/* Proper note styling under title */
.note{
  text-align:center;        /* Centers note under title */
  font-size:22px;           /* Smaller than heading */
  color:#fde68a;            /* Soft gold color */
  margin-top:-10px;         /* Pulls note closer to h1 */
  margin-bottom:16px;       /* Space after note */
  font-style:italic;        /* Looks like instruction */
  opacity:0.9;              /* Slightly subtle */
}






body{
  background:#0e1f1c;
  color:#f6e7b2;
  font-family:Arial,sans-serif;
  padding:20px;
}
h1{text-align:center;color:#facc15}
.panel{border:2px solid #c9a227;padding:14px;margin-bottom:18px}
select,button,input{
  background:#102a2a;
  color:#fef3c7;
  border:1px solid #c9a227;
  padding:6px;
  font-weight:700;
}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #c9a227;padding:6px;text-align:center}
th{background:#123c3c}
.section{font-size:18px;color:#fbbf24;margin-top:14px}
.tara-good{color:#22c55e;font-weight:800}
.tara-bad{color:#ef4444;font-weight:800}
.tara-mixed{color:#fb923c;font-weight:800}

.gold-label{
  display:inline-block;
  padding:6px 14px;
  margin-right:8px;
  background:linear-gradient(145deg,#facc15,#c9a227,#facc15);
  color:#1f2933;
  font-weight:900;
  border-radius:6px;
  border:2px solid #fde68a;
  box-shadow:inset 0 0 6px rgba(255,255,255,0.4),
             0 0 6px rgba(250,204,21,0.6);
}
</style>
</head>

<body>

<h1>Astrological Transit Calculator</h1>

<!-- NOTE START -->
<p class="note">
  |||  Use Your Moon’s Nakshatra  ||  ALP Nakshatra ||   1 to 12 Cusp's Starlord  |||
 
</p>
<!-- NOTE END -->



<div class="panel">

  <span class="gold-label">Nakshatra</span>
  <select id="pivot" onchange="recalc()" oninput="recalc()"></select>

  <label style="margin-left:10px">
    <input type="radio" name="sys" value="vedic" checked onchange="recalc()"> Vedic
  </label>
  <label>
    <input type="radio" name="sys" value="kp" onchange="recalc()"> KP
  </label>

  <label style="margin-left:14px">
    <input type="checkbox" id="ignorePadas" onchange="recalc()"> Ignore Padas
  </label>

  <label style="margin-left:14px">
    <input type="checkbox" id="rkLink" checked> Rahu+Ketu
  </label>

  <span style="margin-left:14px">
  <button onclick="saveChart()">Save</button>
  <button onclick="loadChart()">Load</button>
  <button onclick="loadSwiss()">Load Swiss</button>
  <button onclick="clearAll()">Clear</button>
</span>


</div>

<div class="panel">

  <div class="section">Major Planets</div>
  <table>
    <thead>
      <tr><th>Planet</th><th>Transit Nakshatra</th><th>House</th><th>Tara</th><th>Retro</th></tr>
    </thead>
    <tbody id="majorBody"></tbody>
  </table>

  <div class="section">Minor Planets</div>
  <table>
    <thead>
      <tr><th>Planet</th><th>Transit Nakshatra</th><th>House</th><th>Tara</th><th></th></tr>
    </thead>
    <tbody id="minorBody"></tbody>
  </table>

  <div class="section">Outer Planets</div>
  <table>
    <thead>
      <tr><th>Planet</th><th>Transit Nakshatra</th><th>House</th><th>Tara</th><th></th></tr>
    </thead>
    <tbody id="outerBody"></tbody>
  </table>

</div>

<input type="file" id="fileInput" accept=".json" style="display:none"/>
<input type="file" id="swissInput" accept=".json" style="display:none"/>


<script>
/* =========================================================
   GLOBAL PADA NUMBER (1–108)
   ========================================================= */
function getGlobalPadaNumber(nakIndex, pada){
  // nakIndex starts from 0 (Ashwini = 0)
  // pada starts from 1
  return (nakIndex * 4) + pada;
}
</script>



<script>
/* ===================== DATA ===================== */

const nak = [
"Ashwini","Bharani","Krittika","Rohini","Mrigashira","Ardra","Punarvasu","Pushya","Ashlesha",
"Magha","Purva Phalguni","Uttara Phalguni","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha",
"Moola","Purva Ashadha","Uttara Ashadha","Shravana","Dhanishta","Shatabhisha",
"Purva Bhadrapada","Uttara Bhadrapada","Revati"
];

const nakLords = [
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha",
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha",
"Ketu","Venus","Surya","Chandra","Mangala","Rahu","Jupiter","Saturn","Budha"
];

const rasiNames = [
"ಮೇಷ","ವೃಷಭ","ಮಿಥುನ","ಕಟಕ","ಸಿಂಹ","ಕನ್ಯಾ",
"ತುಲಾ","ವೃಶ್ಚಿಕ","ಧನಸ್ಸು","ಮಕರ","ಕುಂಭ","ಮೀನಾ"
];

const taraNames = [
"Janma","Sampat","Vipath","Kshema","Pratyari",
"Sadhana","Vadha","Mitra","Athi-Mithra"
];

const majorPlanets = [
  {name:"Shani", retro:false},
  {name:"Guru", retro:false},
  {name:"Rahu", retro:true},
  {name:"Ketu", retro:true}
];

const minorPlanets = [
  "Surya","Mangala","Budha","Venus","Chandra"
];

const outerPlanets = [
  "Uranus (Vayu)",
  "Neptune (Varuna)",
  "Pluto (Yama)"
];

/* ===================== PADAS ===================== */

const padas = [];
let padaCount = 0;

for(let i=0;i<27;i++){
  for(let p=1;p<=4;p++){
    const rasiIndex = Math.floor(padaCount / 9);
    const rasiNo = rasiIndex + 1;
    padas.push(`${rasiNames[rasiIndex]} - ${rasiNo} - ${nakLords[i]} - ${nak[i]} - ${p}`);
    padaCount++;
  }
}

const TOTAL_PADAS = padas.length;

/* ===================== UI BUILD ===================== */

const pivot = document.getElementById("pivot");
pivot.innerHTML =
  '<option value="">-- Select Nakshatra --</option>' +
  padas.map((v,i)=>`<option value="${v}">[${i+1}].  ${v}</option>`).join("") +
  padas.map((v,i)=>`<option value="${v}">[${i+1}].  ${v}</option>`).join("");

function buildSelect(){
  return '<option value="">-- Select --</option>' +
    padas.map((v,i)=>`<option value="${v}">[${i+1}].  ${v}</option>`).join("") +
    padas.map((v,i)=>`<option value="${v}">[${i+1}].  ${v}</option>`).join("");
}

const majorBody = document.getElementById("majorBody");
const minorBody = document.getElementById("minorBody");
const outerBody = document.getElementById("outerBody");

majorPlanets.forEach(p=>{
  majorBody.insertAdjacentHTML("beforeend", `
    <tr>
      <td>${p.name}</td>
      <td><select onchange="onPlanetChange(this,'${p.name}')" oninput="onPlanetChange(this,'${p.name}')">${buildSelect()}</select></td>
      <td class="house"></td>
      <td class="tara"></td>
      <td>${p.retro ? '<input type="checkbox" checked onchange="recalc()">' : ''}</td>
    </tr>
  `);
});

minorPlanets.forEach(p=>{
  minorBody.insertAdjacentHTML("beforeend", `
    <tr>
      <td>${p}</td>
      <td><select onchange="recalc()" oninput="recalc()">${buildSelect()}</select></td>
      <td class="house"></td>
      <td class="tara"></td>
      <td></td>
    </tr>
  `);
});

outerPlanets.forEach(p=>{
  outerBody.insertAdjacentHTML("beforeend", `
    <tr>
      <td>${p}</td>
      <td><select onchange="recalc()" oninput="recalc()">${buildSelect()}</select></td>
      <td class="house"></td>
      <td class="tara"></td>
      <td></td>
    </tr>
  `);
});

/* ===================== RAHU–KETU OPTIONAL LINK ===================== */

function onPlanetChange(sel, planet){
  const idx = padas.indexOf(sel.value);
  if(idx < 0){ recalc(); return; }

  const link = document.getElementById("rkLink").checked;
  if(!link){ recalc(); return; }

  const rows = [...majorBody.querySelectorAll("tr")];
  const rahuRow = rows.find(r=>r.children[0].innerText==="Rahu");
  const ketuRow = rows.find(r=>r.children[0].innerText==="Ketu");

  const oppositeIndex = (idx + 54) % TOTAL_PADAS;

  if(planet === "Rahu"){
    ketuRow.querySelector("select").value = padas[oppositeIndex];
  }
  if(planet === "Ketu"){
    rahuRow.querySelector("select").value = padas[oppositeIndex];
  }

  recalc();
}

/* ===================== CORE LOGIC (LOCKED) ===================== */

function recalc(){
  if(!pivot.value) return;

  const pivotIndex = padas.indexOf(pivot.value);
  const pivotNakIndex = Math.floor(pivotIndex / 4);
  const system = document.querySelector('input[name="sys"]:checked').value;
  const ignorePadas = document.getElementById("ignorePadas").checked;

  document.querySelectorAll("#majorBody tr, #minorBody tr, #outerBody tr").forEach(tr=>{
    const sel = tr.querySelector("select").value;
    if(!sel){
      tr.querySelector(".house").innerText="";
      tr.querySelector(".tara").innerText="";
      return;
    }

    const planetIndex = padas.indexOf(sel);
    const planetNakIndex = Math.floor(planetIndex / 4);

    const retroBox = tr.querySelector("input[type=checkbox]");
    const isRetro = retroBox ? retroBox.checked : false;

    let distance;

    if(ignorePadas){
      let nakDistance = isRetro
        ? pivotNakIndex - planetNakIndex
        : planetNakIndex - pivotNakIndex;

      nakDistance = (nakDistance + 27) % 27;
      distance = nakDistance * 4;
    }else{
      distance = isRetro
        ? pivotIndex - planetIndex
        : planetIndex - pivotIndex;

      distance = (distance + TOTAL_PADAS) % TOTAL_PADAS;
    }

    let houseDistance = system === "vedic"
      ? (distance + 4) % TOTAL_PADAS
      : distance;

    const house = Math.floor(houseDistance / 9) % 12 + 1;
    tr.querySelector(".house").innerText = house;

    const taraIndex = Math.floor(distance / 4) % 9;
    const tara = taraNames[taraIndex];

    const td = tr.querySelector(".tara");
    td.innerText = tara;
    td.className = "tara " +
      (["Vipath","Pratyari","Vadha"].includes(tara) ? "tara-bad" :
       ["Sampat","Kshema","Sadhana","Mitra"].includes(tara) ? "tara-good" :
       "tara-mixed");
  });
}

/* ===================== SAVE / LOAD / CLEAR ===================== */

function saveChart(){
  const data = {
    pivot: pivot.value,
    system: document.querySelector('input[name="sys"]:checked').value,
    rkLink: document.getElementById("rkLink").checked,
    major: [...majorBody.querySelectorAll("tr")].map(tr=>({
      v: tr.querySelector("select").value,
      r: tr.querySelector("input[type=checkbox]")?.checked || false
    })),
    minor: [...minorBody.querySelectorAll("tr")].map(tr=>({
      v: tr.querySelector("select").value
    })),
    outer: [...outerBody.querySelectorAll("tr")].map(tr=>({
      v: tr.querySelector("select").value
    }))
  };

  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "AstroTransitChart.json";
  a.click();
}

function loadChart(){
  const inp = document.getElementById("fileInput");
  inp.value="";
  inp.click();

  inp.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = ()=>{
      const d = JSON.parse(reader.result);

      pivot.value = d.pivot;
      document.querySelector(`input[value="${d.system}"]`).checked = true;
      document.getElementById("rkLink").checked = d.rkLink ?? true;

      [...majorBody.querySelectorAll("tr")].forEach((tr,i)=>{
        tr.querySelector("select").value = d.major[i]?.v || "";
        const cb = tr.querySelector("input[type=checkbox]");
        if(cb) cb.checked = d.major[i]?.r || false;
      });

      [...minorBody.querySelectorAll("tr")].forEach((tr,i)=>{
        tr.querySelector("select").value = d.minor[i]?.v || "";
      });

      [...outerBody.querySelectorAll("tr")].forEach((tr,i)=>{
        tr.querySelector("select").value = d.outer[i]?.v || "";
      });

      setTimeout(recalc,0);
    };
    reader.readAsText(file);
  };
}

function clearAll(){
  const ok = confirm(
    "⚠️ WARNING\n\nThis will CLEAR the entire transit chart.\nThis action CANNOT be undone.\n\nDo you want to continue?"
  );
  if(!ok) return;

  pivot.value="";
  document.querySelectorAll("select").forEach(s=>s.value="");
  document.querySelectorAll("input[type=checkbox]").forEach(c=>c.checked=false);
  document.getElementById("rkLink").checked=true;
  document.querySelectorAll(".house,.tara").forEach(td=>td.innerText="");
}
</script>





<script>
/* ===================== SWISS EPHEMERIS LOADER ===================== */

/* degree → nakshatra+pada */
function degreeToPada(deg){
  deg = ((deg % 360) + 360) % 360;
  const padaIndex = Math.floor(deg / (360 / TOTAL_PADAS));
  return padas[padaIndex];
}

/* planet name normalization */
function mapSwissPlanet(name){
  const direct = [
    "Surya","Chandra","Mangala","Budha",
    "Guru","Venus","Shani",
    "Rahu","Rahu_true","Ketu","Ketu_true",
    "Uranus","Neptune","Pluto"
  ];

  if(direct.includes(name)) return name;

  const map = {
    "Sun": "Surya",
    "Moon": "Chandra",
    "Mars": "Mangala",
    "Mercury": "Budha",
    "Jupiter": "Guru",
    "Saturn": "Shani",

    "Uranus": "Uranus",
    "Neptune": "Neptune",
    "Pluto": "Pluto"
  };

  return map[name] || null;
}


/* ===================== PIVOT PRESERVE PATCH ===================== */

/*
This function safely keeps the user-selected Nakshatra.
It prevents Swiss JSON from overriding pivot selection.
*/
function preservePivot(){
  return pivot.value || "";
}




function loadSwiss(){
  const inp = document.getElementById("swissInput");
  inp.value="";
  inp.click();

  inp.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = ()=>{
      const json = JSON.parse(reader.result);

		/* Preserve user-selected pivot */
		const savedPivot = preservePivot();
      if(!json.planets) return alert("Invalid Swiss JSON");

      

      /* === MAJOR PLANETS === */
      [...majorBody.querySelectorAll("tr")].forEach(tr=>{
        const uiName = tr.children[0].innerText;

        for(const key in json.planets){
          const mapped = mapSwissPlanet(key);
          if(mapped === uiName){
            tr.querySelector("select").value =
              degreeToPada(json.planets[key]);
            break;
          }
        }
      });

      /* === MINOR PLANETS === */
      [...minorBody.querySelectorAll("tr")].forEach(tr=>{
        const uiName = tr.children[0].innerText;

        for(const key in json.planets){
          const mapped = mapSwissPlanet(key);
          if(mapped === uiName){
            tr.querySelector("select").value =
              degreeToPada(json.planets[key]);
            break;
          }
        }
      });

      /* === OUTER PLANETS === */
      [...outerBody.querySelectorAll("tr")].forEach(tr=>{
        const uiName = tr.children[0].innerText.split(" ")[0];

        for(const key in json.planets){
          const mapped = mapSwissPlanet(key);
          if(mapped === uiName){
            tr.querySelector("select").value =
              degreeToPada(json.planets[key]);
            break;
          }
        }
      });

		/* Restore pivot if user already selected one */
		if(savedPivot){
		  pivot.value = savedPivot;
		}



      setTimeout(recalc,0);
    };

    reader.readAsText(file);
  };
}












</script>











</body>
</html>
